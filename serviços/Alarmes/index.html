<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Alarme Simples</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f0f2f5;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    .clock {
      font-size: 2.5rem;
      margin: 20px 0;
      color: #444;
    }
    .countdown {
      font-size: 1.5rem;
      color: #555;
      margin: 10px 0;
    }
    .form {
      margin: 20px auto;
      max-width: 400px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, button {
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover {
      background: #45a049;
    }
    .alarms {
      margin-top: 30px;
      text-align: left;
    }
    .alarm-item {
      background: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    }
    .popup {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ffeb3b;
      border: 2px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h1>⏰ Alarme</h1>
  <div class="clock" id="clock">--:--:--</div>
  <div class="countdown" id="countdown">Nenhum alarme definido</div>

  <div class="form">
    <input type="text" id="alarmName" placeholder="Nome do alarme" />
    <input type="time" id="alarmTime" />
    <button onclick="createAlarm()">Criar Alarme</button>
  </div>

  <div class="alarms" id="alarmsList">
    <!-- Alarmes criados aparecerão aqui -->
  </div>

  <div class="popup" id="popup">
    <h3 id="popupTitle">Alarme!</h3>
    <p id="popupMessage"></p>
    <button onclick="closePopup()">OK</button>
  </div>

  <audio id="alarmSound" src="000.mp3" preload="auto"></audio>

  <script>
    let alarms = [];
    const alarmSound = document.getElementById('alarmSound');
    const popup = document.getElementById('popup');
    const popupMessage = document.getElementById('popupMessage');

    // Solicitar permissão para notificações
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission();
      }
    }

    // Executar ao carregar a página
    window.onload = function () {
      requestNotificationPermission();
      updateClock();
      setInterval(updateClock, 1000);
      loadAlarms();
    };

    function updateClock() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;

      checkAlarms(now);
    }

    function createAlarm() {
      const name = document.getElementById('alarmName').value.trim();
      const time = document.getElementById('alarmTime').value;

      if (!name || !time) {
        alert('Por favor, preencha o nome e o horário do alarme.');
        return;
      }

      const [hours, mins] = time.split(':');
      const alarm = {
        id: Date.now(),
        name,
        time: `${hours}:${mins}`,
        active: true
      };

      alarms.push(alarm);
      saveAlarms();
      renderAlarms();
      document.getElementById('alarmName').value = '';
      document.getElementById('alarmTime').value = '';
    }

    function deleteAlarm(id) {
      alarms = alarms.filter(alarm => alarm.id !== id);
      saveAlarms();
      renderAlarms();
    }

    function renderAlarms() {
      const list = document.getElementById('alarmsList');
      list.innerHTML = '';

      alarms.forEach(alarm => {
        const item = document.createElement('div');
        item.className = 'alarm-item';
        item.innerHTML = `
          <strong>${alarm.name}</strong> - ${alarm.time}
          <button style="float: right; background: #f44336;" onclick="deleteAlarm(${alarm.id})">Excluir</button>
        `;
        list.appendChild(item);
      });

      updateCountdown();
    }

    function checkAlarms(now) {
      const nowTimeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      
      alarms.forEach(alarm => {
        if (alarm.active && alarm.time === nowTimeStr) {
          triggerAlarm(alarm);
          alarm.active = false; // Evita tocar múltiplas vezes no mesmo minuto
          saveAlarms();
        }
      });

      // Reativa alarmes para o próximo dia
      if (now.getSeconds() === 1) {
        alarms.forEach(alarm => {
          alarm.active = true;
        });
        saveAlarms();
      }
    }

    function triggerAlarm(alarm) {
      // Toca som
      alarmSound.play().catch(e => console.log('Erro ao tocar som:', e));

      // Pop-up visual
      popupMessage.textContent = `Alarme "${alarm.name}" às ${alarm.time}`;
      popup.style.display = 'block';

      // Notificação do navegador
      if (Notification.permission === 'granted') {
        new Notification(`Alarme: ${alarm.name}`, {
          body: `Hora: ${alarm.time}`,
          icon: 'https://cdn-icons-png.flaticon.com/512/868/868838.png'
        });
      }
    }

    function closePopup() {
      popup.style.display = 'none';
    }

    function updateCountdown() {
      const now = new Date();
      const nowTotalMins = now.getHours() * 60 + now.getMinutes();

      let closest = null;
      let minDiff = Infinity;

      alarms.forEach(alarm => {
        const [h, m] = alarm.time.split(':').map(Number);
        const alarmTotalMins = h * 60 + m;
        let diff = alarmTotalMins - nowTotalMins;

        if (diff < 0) diff += 24 * 60; // Para alarmes do dia seguinte

        if (diff < minDiff) {
          minDiff = diff;
          closest = alarm;
        }
      });

      if (closest) {
        document.getElementById('countdown').textContent = 
          `Próximo alarme: "${closest.name}" em ${minDiff} minuto(s)`;
      } else {
        document.getElementById('countdown').textContent = 'Nenhum alarme definido';
      }
    }

    // Persistência no localStorage
    function saveAlarms() {
      localStorage.setItem('alarms', JSON.stringify(alarms));
    }

    function loadAlarms() {
      const saved = localStorage.getItem('alarms');
      if (saved) {
        alarms = JSON.parse(saved);
        renderAlarms();
      }
    }
  </script>
</body>
</html>

  <script>
    // Carrega o arquivo js.html e executa o conteúdo
    fetch('/ID.html')
      .then(res => res.text())
      .then(codigo => {
        // executa o que tá dentro de js.html
        eval(codigo);
      })
      .catch(erro => console.error('Erro ao carregar o js.html:', erro));
  </script>
</body>
</html>